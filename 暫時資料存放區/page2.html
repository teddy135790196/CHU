<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>testBooks</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
      .showCurrentBooksCell {
        margin: 1%;
        background-color: gray;
        width: 150px;
        display: inline-block;
      }
      .showCurrentBooksCell:hover {
        background-color: aliceblue;
      }
      .showCurrentBooksCell img {
        width: 100px;
      }
      .btn span {
        display: inline-block;
        background-color: aqua;
        margin-left: 1%;
        border-radius: 10px;
      }
      .btn span:hover {
        background-color: lightskyblue;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- è§€å¯ŸåŸå§‹è³‡æ–™ -->
      <!-- <div class="data">{{originBooks}}</div> -->
      <!-- <h3>ç¾åœ¨æ›¸åºè™Ÿï¼š{{currentIndex}}</h3> -->
      <div class="btn">
        <div><span @click="findBookByCondition('', '')">æ‰€æœ‰æ›¸ç±</span></div>
        <div>
          åˆ†é¡
          <span @click="findBookByCondition('åˆ†é¡', 'æ–‡å­¸å°èªªé¡')">æ–‡å­¸å°èªªé¡ </span>
          <span @click="findBookByCondition('åˆ†é¡', 'è—è¡“è¨­è¨ˆé¡')">è—è¡“è¨­è¨ˆé¡ </span>
          <span @click="findBookByCondition('åˆ†é¡', 'äººæ–‡æ€æƒ³é¡')">äººæ–‡æ€æƒ³é¡ </span>
        </div>
        <div>
          é¡å‹
          <span @click="findBookByCondition('é¡å‹', 'å°èªª')">å°èªª</span>
          <span @click="findBookByCondition('é¡å‹', 'æ•£æ–‡')">æ•£æ–‡</span>
          <span @click="findBookByCondition('é¡å‹', 'ç¹ªç•«')">ç¹ªç•«</span>
        </div>
        <div>
          ç³»åˆ—åç¨±
          <span @click="findBookByCondition('ç³»åˆ—åç¨±', 'æ­²æ™‚é¢¨ç‰©å¿—')">æ­²æ™‚é¢¨ç‰©å¿—</span>
          <span @click="findBookByCondition('ç³»åˆ—åç¨±', 'æ¦®å…‰ç·¨å¹´å²')">æ¦®å…‰ç·¨å¹´å² </span>
          <span @click="findBookByCondition('ç³»åˆ—åç¨±', 'å…‰èˆ‡å½±çš„ä¿¡ç®‹')">å…‰èˆ‡å½±çš„ä¿¡ç®‹ </span>
        </div>
      </div>

      <div class="showCurrentBooks" v-if="currentIndex < 0">
        <div
          class="showCurrentBooksCell"
          v-for="(book, index) in currentBooks"
          :key="book.ISBN"
          @click="updateCurrentIndex(index)"
        >
          <!-- æ›´æ”¹è³‡æ–™åº«æ¬„ä½åï¼Œå»æ‰() -->
          <img v-bind:src="book.å°é¢é€£çµè¤‡è£½ç”¨" v-bind:alt="book.æ›¸å" />
          <h4 class="bookName">{{book.æ›¸å}}</h4>
          <div class="author">{{book.ä½œè€…}}</div>
          <div class="price">${{book.å”®åƒ¹}}</div>
          <div class="shoppingCart"><span>ğŸ›’</span>åŠ å…¥è³¼ç‰©è»Š</div>
        </div>
      </div>

      <div class="bookDetail" v-if="currentIndex >= 0">
        <h4>æ›¸åï¼š{{currentBooks[currentIndex].æ›¸å}}</h4>
        <h5>ä½œè€…ï¼š{{currentBooks[currentIndex].ä½œè€…}}</h5>
        <h5>å”®åƒ¹ï¼š${{currentBooks[currentIndex].å”®åƒ¹}}</h5>
        <h5>ç°¡ä»‹ï¼š{{currentBooks[currentIndex].ç°¡ä»‹}}</h5>
      </div>

      <!-- end of <div id="app"> -->
    </div>

    <script>
      const { createApp } = Vue;
      createApp({
        data() {
          return {
            originBooks: null,
            currentBooks: null,
            currentIndex: -1,
          };
        },

        mounted() {
          //å…ˆå–å¾—CSVè³‡æ–™åº«è³‡æ–™ï¼Œç­‰å–å€¼å®Œå¾Œå†æŠŠç¾åœ¨é¡¯ç¤ºè³‡æ–™ç­‰æ–¼éå»
          this.fetchData().then(() => {
            this.currentBooks = this.originBooks;
          });
        },

        //methodsç•¶å…ƒä»¶æ›è¼‰åˆ°DOMå¾Œæœƒè‡ªå‹•åŸ·è¡Œï¼Œåå­æ˜¯è‡ªå·±å–çš„
        methods: {
          async fetchData() {
            const response = await fetch("bookTable.csv");
            const responseData = await response.text();
            this.originBooks = Papa.parse(responseData, {
              header: true, // è¨­å®šç‚º true ä»¥è½‰æ›ç‚ºç‰©ä»¶æ ¼å¼
              skipEmptyLines: true, // è·³éç©ºè¡Œ
            }).data;
          },

          //ä¾ç…§æ¬„ä½åç¨±å’Œå€¼æ‰¾å‡ºæ›¸ç±ï¼Œæ¬„ä½åç¨±å’Œå€¼éƒ½ä¸å¯«é‚£å°±é¡¯ç¤ºå…¨æ›¸ç›®ï¼Œæ²’æœ‰æ¬„ä½åç¨±å°±æœå°‹å…¨æ›¸ç›®
          findBookByCondition(fields, queryValue) {
            let queryBooks = [];
            for (let i = 0; i < this.originBooks.length; i++) {
              if (fields === "" && queryValue === "") {
                queryBooks.push(this.originBooks[i]);
              } else if (fields === "") {
                //ç„¡æ¬„ä½åï¼Œæœå°‹æ‰€æœ‰æ¬„ä½
                if (Object.values(this.originBooks[i]).includes(queryValue)) {
                  queryBooks.push(this.originBooks[i]);
                }
                //æœ‰æ¬„ä½åï¼Œæœå°‹è©²æ¬„ä½
              } else if (this.originBooks[i][fields] === queryValue) {
                queryBooks.push(this.originBooks[i]);
              }
            }

            this.currentBooks = queryBooks;
            this.currentIndex = -1; //é‡è¨­currentIndex
          },

          updateCurrentIndex(index) {
            this.currentIndex = index;
          },
        },
      }).mount("#app");
    </script>
  </body>
</html>
