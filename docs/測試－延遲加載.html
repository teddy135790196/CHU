<div class="recommend">
	<div class="recommendCell" v-for="(book, index) in books" :key="book.ISBN">
		<div class="recommendCellImg">
			<img v-bind:data-src="book.ç¶²å€" v-bind:alt="book.æ›¸å"
				src="https://lh3.googleusercontent.com/pw/AP1GczNmV4wbB9B3ijwkPFo0K_sGAi--XXI2PxC8xJXchrUHOq4xqDTdBucwM-Kbz6gXRfEhh12NHvIAx_Gjq33EtQvFkGxSHSoLMhQCQFcZmvqvHsxQUrBF3HNl9t2Jy04IHIDRLjNI4yEmt7unWZQROFbf=w460-h580-s-no-gm?authuser=0"
				class="lazy-load-image" />
		</div>
		<h4 class="bookName">{{book.æ›¸å}}</h4>
		<div class="author">{{book.ä½œè€…}}</div>
		<div class="price">${{book.åƒ¹æ ¼}}</div>
		<div class="shoppingCart"><span>ğŸ›’</span>åŠ å…¥è³¼ç‰©è»Š</div>
	</div>
</div>

<!-- å¼•å…¥ Vue 3 -->
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

<script>
	const { createApp, onMounted } = Vue;

	createApp({
		data() {
			return {
				books: [
					{
						æ›¸å: "Vue 3 å¿«é€Ÿä¸Šæ‰‹",
						ä½œè€…: "å°æ˜",
						åƒ¹æ ¼: 450,
						ç¶²å€: "https://via.placeholder.com/200x280?text=Vue3",
						ISBN: "1111"
					},
					{
						æ›¸å: "JavaScript ç²¾é€š",
						ä½œè€…: "å°ç¾",
						åƒ¹æ ¼: 520,
						ç¶²å€: "https://via.placeholder.com/200x280?text=JS",
						ISBN: "2222"
					}
				]
			};
		},
		mounted() {
			this.initLazyLoadImages();
		},
		methods: {
			//åˆå§‹åŒ–åœ–ç‰‡å»¶é²è¼‰å…¥
			initLazyLoadImages() {
				// æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´ Intersection Observer
				if ("IntersectionObserver" in window) {
					const observer = new IntersectionObserver(
						//entriesæ˜¯è¢«ç›£æ§çš„æ‰€æœ‰å…ƒç´ 
						(entries, observer) => {
							entries.forEach(entry => {
								//å¦‚æœç›£æ§çš„å…ƒç´ å·²ç¶“é€²å…¥è¦–çª—
								if (entry.isIntersecting) {
									const img = entry.target;
									// ç•¶åœ–ç‰‡é€²å…¥è¦–çª—æ™‚ï¼Œå°‡ data-src çš„å€¼è³¦çµ¦ src
									img.src = img.dataset.src;
									// è¼‰å…¥å¾Œç§»é™¤ class æˆ–åŸ·è¡Œå…¶ä»–æ“ä½œï¼ˆä¾‹å¦‚ç§»é™¤ç›£è½ï¼‰
									img.classList.remove("lazy-load-image"); // ç§»é™¤ class
									observer.unobserve(img); // åœæ­¢ç›£è½å·²è¼‰å…¥çš„åœ–ç‰‡
								}
							});
						},
						{
							rootMargin: "0px 0px 100px 0px", // åœ–ç‰‡é€²å…¥è¦–çª—ä¸‹æ–¹ 100px æ™‚å°±é–‹å§‹è¼‰å…¥
						}
					);

					const lazyImages = document.querySelectorAll(".lazy-load-image");
					lazyImages.forEach(img => {
						observer.observe(img); // é–‹å§‹ç›£è½æ¯å¼µ.lazy-load-imageåœ–ç‰‡
					});
				} else {
					// å¦‚æœç€è¦½å™¨ä¸æ”¯æ´ Intersection Observerï¼Œå‰‡å›é€€åˆ°ä¸€æ¬¡æ€§è¼‰å…¥æ‰€æœ‰åœ–ç‰‡
					console.warn("Intersection Observer is not supported, all images will be loaded immediately.");
					const lazyImages = document.querySelectorAll(".lazy-load-image");
					lazyImages.forEach(img => {
						img.src = img.dataset.src;
						img.classList.remove("lazy-load-image");
					});
				}
			},
		}
	}).mount("#app");
</script>